/** @format */

// gameInit.js

import { initializePlayer } from "./player.js";
import { gameLoop } from "./gameLoop.js";
// Function to initialize the game
function initializeGame() {
  // Set up canvas context
  const canvas = createCanvas();
  const ctx = canvas.getContext("2d");

  // Create game over modal
  const modalBackdrop = createModalBackdrop();
  const { modal, closeBtn, finalScoreText, restartBtn } = createGameOverModal();

  // Player initialization
  const player = initializePlayer(canvas);

  // Obstacles initialization
  let obstacles = [];

  // Player score initialization
  let playerScore = 0;
  let scoreTick = 0;
  let scoreTickInterval = 20; // Initial score tick interval

  // Initialize high score from local storage or default to 0
  let highScore = localStorage.getItem("highScore") || 0;

  // Start the game loop
  gameLoop();

  // Function to create canvas element
  function createCanvas() {
    const canvas = document.createElement("canvas");
    canvas.id = "gameCanvas";
    canvas.width = 800;
    canvas.height = 400;
    document.body.appendChild(canvas);
    return canvas;
  }

  // Function to create game over modal backdrop
  function createModalBackdrop() {
    const modalBackdrop = document.createElement("div");
    modalBackdrop.classList.add("backdrop");
    modalBackdrop.id = "gameOverModal";
    modalBackdrop.style.display = "none";
    document.body.appendChild(modalBackdrop);
    return modalBackdrop;
  }

  // Function to create game over modal
  function createGameOverModal() {
    const modal = document.createElement("div");
    modal.classList.add("modal");
    modalBackdrop.appendChild(modal);

    const modalContent = document.createElement("div");
    modalContent.classList.add("modal-content");
    modal.appendChild(modalContent);

    const closeBtn = document.createElement("span");
    closeBtn.classList.add("close");
    closeBtn.innerHTML = "&times;";
    modalContent.appendChild(closeBtn);

    const modalTitle = document.createElement("h2");
    modalTitle.textContent = "Game Over";
    modalContent.appendChild(modalTitle);

    const finalScoreText = document.createElement("p");
    finalScoreText.innerHTML = "Your score: <span id='finalScore'>0</span>";
    modalContent.appendChild(finalScoreText);

    const restartBtn = document.createElement("button");
    restartBtn.id = "restartButton";
    restartBtn.textContent = "Restart Game";
    modalContent.appendChild(restartBtn);

    return { modal, closeBtn, finalScoreText, restartBtn };
  }

  // Return necessary variables and functions for other modules to use
  return {
    canvas,
    ctx,
    modalBackdrop,
    modal,
    closeBtn,
    finalScoreText,
    restartBtn,
    player,
    obstacles,
    playerScore,
    scoreTick,
    scoreTickInterval,
    highScore,
  };
}

export { initializeGame };
