/** @format */

// obstacles.js

// Import the canvas variable from main.js
import { canvas, obstacles } from "../main.js";

// Define canvas, player, and ctx variables
let player, ctx;

// Function to initialize obstacle module
function initializeObstacles(playerRef, ctxRef) {
  player = playerRef;
  ctx = ctxRef;
}

// Function to create obstacles
function createObstacle() {
  // Adjust the probability of obstacle creation
  if (Math.random() < 0.02) {
    // Decreased from 0.02 to 0.01
    const obstacle = {
      x: canvas.width,
      y: canvas.height - 20 - player.height, // Adjust y position to account for player height
      width: 50,
      height: 50,
      speed: 5,
    };
    obstacles.push(obstacle);
  }
}

// Function to update obstacles' positions
function updateObstacles() {
  if (Math.random() <= 0.5) {
    createObstacle();
  }

  for (let i = 0; i < obstacles.length; i++) {
    obstacles[i].x -= obstacles[i].speed;

    // Remove obstacles that go offscreen
    if (obstacles[i].x + obstacles[i].width < 0) {
      obstacles.splice(i, 1);
    }
  }
}

// Function to render obstacles on the canvas
function renderObstacles() {
  ctx.fillStyle = "red";
  for (let obstacle of obstacles) {
    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
  }
}

// Export obstacle functions for use in other modules
export {
  initializeObstacles,
  createObstacle,
  updateObstacles,
  renderObstacles,
};
